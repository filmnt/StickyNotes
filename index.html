<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap">
    <link rel="icon" type="image/gif" href="favicon.gif">
    <title id="page-title">Sticky Notes</title>
    <style>
        body {
            background-color: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            width: 100vw;
            position: relative;
            overflow: hidden;
            margin: 0;
            touch-action: none;
            transition: background-color 0.3s ease;
        }

        body.light-mode {
            background-color: #ffffff;
        }

        body.dark-mode {
            background-color: #1a1a1a;
        }

        .container {
            position: absolute;
            width: 100vw;
            height: 100vh;
            top: 0;
            left: 0;
            overflow: hidden;
        }

        .note {
            position: absolute;
            background-color: #ffffcc;
            width: 300px;
            height: 300px;
            min-width: 300px;
            min-height: 80px;
            max-width: 90vw;
            max-height: 90vh;
            font-size: 15px;
            font-family: "Roboto Mono", monospace;
            border-radius: 2px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            z-index: 1;
            touch-action: none;
        }

        .note .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #ffeb3b;
            margin: 0;
            padding: 5px 10px;
            cursor: move;
            position: sticky;
            top: 0;
            z-index: 3;
            touch-action: none;
        }

        .note .header .left-group {
            display: flex;
            align-items: center;
            gap: 2px;
            margin-left: -5px;
        }
        .note .header .delete {
           margin-right: -5px; 
        }

        .note .header .toolbar {
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .note .header button {
            font-size: 14px;
            padding: 4px 8px;
            background-color: transparent;
            color: #1a1a1a;
            border: none;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .note .header button:hover {
            color: #ff0000;
        }

        .note .header select {
            font-family: 'Roboto Mono', monospace;
            font-size: 12px;
            padding: 2px;
            border: none;
            background: transparent;
            cursor: pointer;
            height: 24px;
        }

        .note .header input[type="color"] {
            width: 18px;
            height: 24px;
            padding: 0;
            border: none;
            background: transparent;
            cursor: pointer;
        }

        .note .content {
            flex: 1;
            border: none;
            background: transparent;
            padding: 5px;
            outline: none;
            cursor: text;
            white-space: pre-wrap;
            overflow-y: auto;
            -ms-overflow-style: none;
            scrollbar-width: none;
            touch-action: pan-y pinch-zoom;
        }

        .note .content::-webkit-scrollbar {
            display: none;
        }

        .resize-handle {
            position: absolute;
            z-index: 2;
            touch-action: none;
            background-color: transparent;
        }

        .resize-handle.left {
            left: -5px;
            top: 0;
            width: 10px;
            height: 100%;
            cursor: w-resize;
        }

        .resize-handle.right {
            right: -5px;
            top: 0;
            width: 10px;
            height: 100%;
            cursor: e-resize;
        }

        .resize-handle.bottom {
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 10px;
            cursor: s-resize;
        }

        .resize-handle.bottom-left {
            bottom: -5px;
            left: -5px;
            width: 15px;
            height: 15px;
            cursor: sw-resize;
        }

        .resize-handle.bottom-right {
            bottom: -5px;
            right: -5px;
            width: 15px;
            height: 15px;
            cursor: se-resize;
        }

        .bottom-left-buttons {
            position: fixed;
            bottom: 12px;
            left: 60px;
            display: flex;
            gap: 12px;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease;
        }

        .bottom-left-buttons.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .bottom-right-buttons {
            position: fixed;
            bottom: 12px;
            right: 12px;
            display: flex;
            gap: 12px;
            z-index: 100;
        }

        .bottom-left-buttons button,
        .bottom-right-buttons button,
        #settingsBtn {
            font-family: 'Roboto Mono', monospace;
            font-size: 24px;
            width: 48px;
            height: 48px;
            padding: 0;
            background-color: #000000;
            color: #ffffff;
            border: 2px solid #ffffff;
            cursor: pointer;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
            position: relative;
        }

        .bottom-left-buttons button:hover,
        .bottom-right-buttons button:hover,
        #settingsBtn:hover {
            background-color: #ffffff;
            color: #000000;
        }

        body.light-mode .bottom-left-buttons button,
        body.light-mode .bottom-right-buttons button,
        body.light-mode #settingsBtn {
            background-color: #ffffff;
            color: #000000;
            border: 2px solid #000000;
        }

        body.light-mode .bottom-left-buttons button:hover,
        body.light-mode .bottom-right-buttons button:hover,
        body.light-mode #settingsBtn:hover {
            background-color: #000000;
            color: #ffffff;
        }

        #settingsBtn {
            position: fixed;
            bottom: 12px;
            left: 12px;
        }

        .tooltip {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #ffffff;
            color: #000000;
            border: 1px solid #000000;
            padding: 4px 8px;
            font-family: 'Roboto Mono', monospace;
            font-size: 12px;
            border-radius: 4px;
            white-space: nowrap;
            z-index: 101;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .bottom-left-buttons button:hover .tooltip,
        .bottom-right-buttons button:hover .tooltip,
        #settingsBtn:hover .tooltip {
            opacity: 1;
        }

        body.dark-mode .tooltip {
            background-color: #000000;
            color: #ffffff;
            border: 1px solid #ffffff;
        }

        @media (max-width: 768px) {
            .note {
                width: 200px;
                height: 250px;
                min-width: 200px;
                font-size: 14px;
            }

            .bottom-left-buttons button,
            .bottom-right-buttons button,
            #settingsBtn {
                width: 43.2px;
                height: 43.2px;
                font-size: 21.6px;
            }

            .bottom-left-buttons,
            .bottom-right-buttons {
                gap: 8px;
            }

            .bottom-left-buttons {
                left: 55px;
            }

            .note .header button {
                font-size: 12px;
                padding: 4px 6px;
            }

            .note .header select {
                font-size: 10px;
                height: 20px;
            }

            .note .header input[type="color"] {
                width: 15px;
                height: 20px;
            }

            .resize-handle.left,
            .resize-handle.right {
                width: 12px;
            }

            .resize-handle.bottom {
                height: 12px;
            }

            .resize-handle.bottom-left,
            .resize-handle.bottom-right {
                width: 18px;
                height: 18px;
            }

            .tooltip {
                font-size: 10px;
                padding: 3px 6px;
                top: -36px;
            }

            .bottom-left-buttons button.touched .tooltip,
            .bottom-right-buttons button.touched .tooltip,
            #settingsBtn.touched .tooltip {
                opacity: 0;
            }
        }
    </style>
</head>
<body class="light-mode">
    <div id="container" class="container"></div>

    <button id="settingsBtn" data-tooltip-key="settings">‚öôÔ∏è</button>
    <div class="bottom-left-buttons">
        <button id="saveBtn" data-tooltip-key="save">üíæ</button>
        <button id="loadBtn" data-tooltip-key="load">üìÇ</button>
        <button id="resetBtn" data-tooltip-key="reset">üóëÔ∏è</button>
    </div>

    <div class="bottom-right-buttons">
        <button id="fullscreenBtn" data-tooltip-key="fullscreen">‚õ∂</button>
        <button id="addBtn" data-tooltip-key="addNote">+</button>
        <button id="undoBtn" data-tooltip-key="undo">‚Ü∫</button>
        <button id="darkModeToggle" data-tooltip-key="darkMode">
            <span id="darkModeIcon" class="moon-icon">üåô</span>
        </button>
    </div>

    <input type="file" id="loadFile" accept=".json" style="display: none;" onchange="loadNotesFromFile(event)">

    <script>
        const translations = {
            en: {
                pageTitle: "Sticky Notes",
                settings: "Settings",
                save: "Save",
                load: "Load",
                reset: "Reset All",
                fullscreen: "Fullscreen",
                addNote: "Add Note",
                undo: "Undo",
                darkMode: "Dark Mode",
                lastNoteReset: "This is the last note. Would you like to reset all notes?",
                resetConfirm: "Would you like to reset all notes?",
                loadError: "Note load error: Invalid file format.",
                saveFilePrefix: "StickyNotes"
            },
            ko: {
                pageTitle: "Ïä§Ìã∞Ïª§ Î©îÎ™®",
                settings: "ÏÑ§Ï†ï",
                save: "Ï†ÄÏû•",
                load: "Î∂àÎü¨Ïò§Í∏∞",
                reset: "Î™®Îëê Ï¥àÍ∏∞Ìôî",
                fullscreen: "Ï†ÑÏ≤¥ÌôîÎ©¥",
                addNote: "ÎÖ∏Ìä∏ Ï∂îÍ∞Ä",
                undo: "Ïã§Ìñâ Ï∑®ÏÜå",
                darkMode: "Îã§ÌÅ¨ Î™®Îìú",
                lastNoteReset: "ÎßàÏßÄÎßâ ÎÖ∏Ìä∏ÏûÖÎãàÎã§. Î™®Îì† ÎÖ∏Ìä∏Î•º Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?",
                resetConfirm: "Î™®Îì† ÎÖ∏Ìä∏Î•º Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?",
                loadError: "ÎÖ∏Ìä∏ Î∂àÎü¨Ïò§Í∏∞ Ïò§Î•ò: ÏûòÎ™ªÎêú ÌååÏùº ÌòïÏãùÏûÖÎãàÎã§.",
                saveFilePrefix: "Ïä§Ìã∞Ïª§ Î©îÎ™®"
            },
            ja: {
                pageTitle: "‰ªòÁÆã",
                settings: "Ë®≠ÂÆö",
                save: "‰øùÂ≠ò",
                load: "Ë™≠„ÅøËæº„ÇÄ",
                reset: "„Åô„Åπ„Å¶„É™„Çª„ÉÉ„Éà",
                fullscreen: "„Éï„É´„Çπ„ÇØ„É™„Éº„É≥",
                addNote: "„Éé„Éº„Éà„ÇíËøΩÂä†",
                undo: "ÂÖÉ„Å´Êàª„Åô",
                darkMode: "„ÉÄ„Éº„ÇØ„É¢„Éº„Éâ",
                lastNoteReset: "„Åì„Çå„ÅåÊúÄÂæå„ÅÆ„Éé„Éº„Éà„Åß„Åô„ÄÇ„Åô„Åπ„Å¶„ÅÆ„Éé„Éº„Éà„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü",
                resetConfirm: "„Åô„Åπ„Å¶„ÅÆ„Éé„Éº„Éà„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü",
                loadError: "„Éé„Éº„ÉàË™≠„ÅøËæº„Åø„Ç®„É©„ÉºÔºöÁÑ°Âäπ„Å™„Éï„Ç°„Ç§„É´ÂΩ¢Âºè„Åß„Åô„ÄÇ",
                saveFilePrefix: "‰ªòÁÆã"
            },
            de: {
                pageTitle: "Haftnotizen",
                settings: "Einstellungen",
                save: "Speichern",
                load: "Laden",
                reset: "Alles zur√ºcksetzen",
                fullscreen: "Vollbild",
                addNote: "Notiz hinzuf√ºgen",
                undo: "R√ºckg√§ngig",
                darkMode: "Dunkler Modus",
                lastNoteReset: "Dies ist die letzte Notiz. M√∂chten Sie alle Notizen zur√ºcksetzen?",
                resetConfirm: "M√∂chten Sie alle Notizen zur√ºcksetzen?",
                loadError: "Fehler beim Laden der Notiz: Ung√ºltiges Dateiformat.",
                saveFilePrefix: "Haftnotizen"
            },
            es: {
                pageTitle: "Notas Adhesivas",
                settings: "Configuraci√≥n",
                save: "Guardar",
                load: "Cargar",
                reset: "Restablecer Todo",
                fullscreen: "Pantalla Completa",
                addNote: "A√±adir Nota",
                undo: "Deshacer",
                darkMode: "Modo Oscuro",
                lastNoteReset: "Esta es la √∫ltima nota. ¬øDesea restablecer todas las notas?",
                resetConfirm: "¬øDesea restablecer todas las notas?",
                loadError: "Error al cargar la nota: Formato de archivo inv√°lido.",
                saveFilePrefix: "NotasAdesivas"
            },
            zh: {
                pageTitle: "‰æøÁ¨∫",
                settings: "ËÆæÁΩÆ",
                save: "‰øùÂ≠ò",
                load: "Âä†ËΩΩ",
                reset: "ÂÖ®ÈÉ®ÈáçÁΩÆ",
                fullscreen: "ÂÖ®Â±è",
                addNote: "Ê∑ªÂä†‰æøÁ¨∫",
                undo: "Êí§ÈîÄ",
                darkMode: "ÊöóÈªëÊ®°Âºè",
                lastNoteReset: "ËøôÊòØÊúÄÂêé‰∏Ä‰∏™‰æøÁ¨∫„ÄÇÊòØÂê¶Ë¶ÅÈáçÁΩÆÊâÄÊúâ‰æøÁ¨∫Ôºü",
                resetConfirm: "ÊòØÂê¶Ë¶ÅÈáçÁΩÆÊâÄÊúâ‰æøÁ¨∫Ôºü",
                loadError: "‰æøÁ¨∫Âä†ËΩΩÈîôËØØÔºöÊñá‰ª∂Ê†ºÂºèÊó†Êïà„ÄÇ",
                saveFilePrefix: "‰æøÁ¨∫"
            },
            fr: {
                pageTitle: "Notes Adh√©sives",
                settings: "Param√®tres",
                save: "Enregistrer",
                load: "Charger",
                reset: "Tout r√©initialiser",
                fullscreen: "Plein √©cran",
                addNote: "Ajouter une note",
                undo: "Annuler",
                darkMode: "Mode sombre",
                lastNoteReset: "Ceci est la derni√®re note. Voulez-vous r√©initialiser toutes les notes ?",
                resetConfirm: "Voulez-vous r√©initialiser toutes les notes ?",
                loadError: "Erreur de chargement des notes : Format de fichier invalide.",
                saveFilePrefix: "NotesAdh√©sives"
            },
            ru: {
                pageTitle: "–°—Ç–∏–∫–µ—Ä—ã",
                settings: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏",
                save: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",
                load: "–ó–∞–≥—Ä—É–∑–∏—Ç—å",
                reset: "–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ",
                fullscreen: "–ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω",
                addNote: "–î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É",
                undo: "–û—Ç–º–µ–Ω–∏—Ç—å",
                darkMode: "–¢–µ–º–Ω—ã–π —Ä–µ–∂–∏–º",
                lastNoteReset: "–≠—Ç–æ –ø–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–º–µ—Ç–∫–∞. –•–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –∑–∞–º–µ—Ç–∫–∏?",
                resetConfirm: "–•–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –∑–∞–º–µ—Ç–∫–∏?",
                loadError: "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–º–µ—Ç–æ–∫: –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞.",
                saveFilePrefix: "–°—Ç–∏–∫–µ—Ä—ã"
            },
            pt: {
                pageTitle: "Notas Adesivas",
                settings: "Configura√ß√µes",
                save: "Salvar",
                load: "Carregar",
                reset: "Redefinir Tudo",
                fullscreen: "Tela Cheia",
                addNote: "Adicionar Nota",
                undo: "Desfazer",
                darkMode: "Modo Escuro",
                lastNoteReset: "Esta √© a √∫ltima nota. Deseja redefinir todas as notas?",
                resetConfirm: "Deseja redefinir todas as notas?",
                loadError: "Erro ao carregar nota: Formato de arquivo inv√°lido.",
                saveFilePrefix: "NotasAdesivas"
            },
            ar: {
                pageTitle: "ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ŸÑÿßÿµŸÇÿ©",
                settings: "ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™",
                save: "ÿ≠ŸÅÿ∏",
                load: "ÿ™ÿ≠ŸÖŸäŸÑ",
                reset: "ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÉŸÑ",
                fullscreen: "ÿ¥ÿßÿ¥ÿ© ŸÉÿßŸÖŸÑÿ©",
                addNote: "ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÑÿßÿ≠ÿ∏ÿ©",
                undo: "ÿ™ÿ±ÿßÿ¨ÿπ",
                darkMode: "ÿßŸÑŸàÿ∂ÿπ ÿßŸÑÿØÿßŸÉŸÜ",
                lastNoteReset: "Ÿáÿ∞Ÿá ŸáŸä ÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿ© ÿßŸÑÿ£ÿÆŸäÿ±ÿ©. ŸáŸÑ ÿ™ÿ±ÿ∫ÿ® ŸÅŸä ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ÿü",
                resetConfirm: "ŸáŸÑ ÿ™ÿ±ÿ∫ÿ® ŸÅŸä ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ÿü",
                loadError: "ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿ©: ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑŸÖŸÑŸÅ ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠.",
                saveFilePrefix: "ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™_ŸÑÿßÿµŸÇÿ©"
            },
            bn: {
                pageTitle: "‡¶∏‡ßç‡¶ü‡¶ø‡¶ï‡¶ø ‡¶®‡ßã‡¶ü",
                settings: "‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏",
                save: "‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£",
                load: "‡¶≤‡ßã‡¶°",
                reset: "‡¶∏‡¶¨ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü",
                fullscreen: "‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®",
                addNote: "‡¶®‡ßã‡¶ü ‡¶Ø‡ßã‡¶ó",
                undo: "‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶æ‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º ‡¶´‡¶ø‡¶∞‡ßÅ‡¶®",
                darkMode: "‡¶°‡¶æ‡¶∞‡ßç‡¶ï ‡¶Æ‡ßã‡¶°",
                lastNoteReset: "‡¶è‡¶ü‡¶ø ‡¶∂‡ßá‡¶∑ ‡¶®‡ßã‡¶ü‡•§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶∏‡¶¨ ‡¶®‡ßã‡¶ü ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?",
                resetConfirm: "‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶∏‡¶¨ ‡¶®‡ßã‡¶ü ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?",
                loadError: "‡¶®‡ßã‡¶ü ‡¶≤‡ßã‡¶° ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ‡¶´‡¶æ‡¶á‡¶≤ ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶Ö‡¶¨‡ßà‡¶ß‡•§",
                saveFilePrefix: "‡¶∏‡ßç‡¶ü‡¶ø‡¶ï‡¶ø_‡¶®‡ßã‡¶ü"
            },
            pa: {
                pageTitle: "‡®∏‡®ü‡®ø‡©±‡®ï‡©Ä ‡®®‡©ã‡®ü‡®∏",
                settings: "‡®∏‡©à‡®ü‡®ø‡©∞‡®ó‡®ú‡®º",
                save: "‡®∏‡©∞‡®≠‡®æ‡®≤‡©ã",
                load: "‡®≤‡©ã‡®°",
                reset: "‡®∏‡®≠ ‡®∞‡©Ä‡®∏‡©à‡®ü",
                fullscreen: "‡®™‡©Ç‡®∞‡©Ä ‡®∏‡®ï‡©ç‡®∞‡©Ä‡®®",
                addNote: "‡®®‡©ã‡®ü ‡®∏‡®º‡®æ‡®Æ‡®≤ ‡®ï‡®∞‡©ã",
                undo: "‡®µ‡®æ‡®™‡®∏",
                darkMode: "‡®°‡®æ‡®∞‡®ï ‡®Æ‡©ã‡®°",
                lastNoteReset: "‡®á‡®π ‡®Ü‡®ñ‡®∞‡©Ä ‡®®‡©ã‡®ü ‡®π‡©à‡•§ ‡®ï‡©Ä ‡®§‡©Å‡®∏‡©Ä‡®Ç ‡®∏‡®æ‡®∞‡©á ‡®®‡©ã‡®ü‡®∏ ‡®∞‡©Ä‡®∏‡©à‡®ü ‡®ï‡®∞‡®®‡®æ ‡®ö‡®æ‡®π‡©Å‡©∞‡®¶‡©á ‡®π‡©ã?",
                resetConfirm: "‡®ï‡©Ä ‡®§‡©Å‡®∏‡©Ä‡®Ç ‡®∏‡®æ‡®∞‡©á ‡®®‡©ã‡®ü‡®∏ ‡®∞‡©Ä‡®∏‡©à‡®ü ‡®ï‡®∞‡®®‡®æ ‡®ö‡®æ‡®π‡©Å‡©∞‡®¶‡©á ‡®π‡©ã?",
                loadError: "‡®®‡©ã‡®ü ‡®≤‡©ã‡®° ‡®ó‡®≤‡®§‡©Ä: ‡®´‡®æ‡®à‡®≤ ‡®´‡®æ‡®∞‡®Æ‡©à‡®ü ‡®Ö‡®µ‡©à‡®ß ‡®π‡©à‡•§",
                saveFilePrefix: "‡®∏‡®ü‡®ø‡©±‡®ï‡©Ä_‡®®‡©ã‡®ü‡®∏"
            },
            hi: {
                pageTitle: "‡§∏‡•ç‡§ü‡§ø‡§ï‡•Ä ‡§®‡•ã‡§ü‡•ç‡§∏",
                settings: "‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏",
                save: "‡§∏‡§π‡•á‡§ú‡•á‡§Ç",
                load: "‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç",
                reset: "‡§∏‡§≠‡•Ä ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç",
                fullscreen: "‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®",
                addNote: "‡§®‡•ã‡§ü ‡§ú‡•ã‡§°‡§º‡•á‡§Ç",
                undo: "‡§™‡•Ç‡§∞‡•ç‡§µ‡§µ‡§§ ‡§ï‡§∞‡•á‡§Ç",
                darkMode: "‡§°‡§æ‡§∞‡•ç‡§ï ‡§Æ‡•ã‡§°",
                lastNoteReset: "‡§Ø‡§π ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§®‡•ã‡§ü ‡§π‡•à‡•§ ‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§∏‡§≠‡•Ä ‡§®‡•ã‡§ü‡•ç‡§∏ ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?",
                resetConfirm: "‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§∏‡§≠‡•Ä ‡§®‡•ã‡§ü‡•ç‡§∏ ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?",
                loadError: "‡§®‡•ã‡§ü ‡§≤‡•ã‡§° ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§´‡§º‡§æ‡§á‡§≤ ‡§™‡•ç‡§∞‡§æ‡§∞‡•Ç‡§™‡•§",
                saveFilePrefix: "‡§∏‡•ç‡§ü‡§ø‡§ï‡•Ä_‡§®‡•ã‡§ü‡•ç‡§∏"
            },
            ms: {
                pageTitle: "Nota Melekat",
                settings: "Tetapan",
                save: "Simpan",
                load: "Muat",
                reset: "Set Semula Semua",
                fullscreen: "Skrin Penuh",
                addNote: "Tambah Nota",
                undo: "Buat Asal",
                darkMode: "Mod Gelap",
                lastNoteReset: "Ini adalah nota terakhir. Adakah anda ingin menetapkan semula semua nota?",
                resetConfirm: "Adakah anda ingin menetapkan semula semua nota?",
                loadError: "Ralat muat nota: Format fail tidak sah.",
                saveFilePrefix: "NotaMelekat"
            },
            it: {
                pageTitle: "Note Adesive",
                settings: "Impostazioni",
                save: "Salva",
                load: "Carica",
                reset: "Ripristina Tutto",
                fullscreen: "Schermo Intero",
                addNote: "Aggiungi Nota",
                undo: "Annulla",
                darkMode: "Modalit√† Scura",
                lastNoteReset: "Questa √® l'ultima nota. Vuoi ripristinare tutte le note?",
                resetConfirm: "Vuoi ripristinare tutte le note?",
                loadError: "Errore di caricamento nota: Formato file non valido.",
                saveFilePrefix: "NoteAdesive"
            },
            tr: {
                pageTitle: "Yapƒ±≈ükan Notlar",
                settings: "Ayarlar",
                save: "Kaydet",
                load: "Y√ºkle",
                reset: "T√ºm√ºn√º Sƒ±fƒ±rla",
                fullscreen: "Tam Ekran",
                addNote: "Not Ekle",
                undo: "Geri Al",
                darkMode: "Karanlƒ±k Mod",
                lastNoteReset: "Bu son not. T√ºm notlarƒ± sƒ±fƒ±rlamak ister misiniz?",
                resetConfirm: "T√ºm notlarƒ± sƒ±fƒ±rlamak ister misiniz?",
                loadError: "Not y√ºkleme hatasƒ±: Ge√ßersiz dosya formatƒ±.",
                saveFilePrefix: "Yapƒ±≈ükanNotlar"
            },
            ta: {
                pageTitle: "‡Æí‡Æü‡Øç‡Æü‡ØÅ ‡Æï‡ØÅ‡Æ±‡Æø‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øç",
                settings: "‡ÆÖ‡ÆÆ‡Øà‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øç",
                save: "‡Æö‡Øá‡ÆÆ‡Æø",
                load: "‡Æè‡Æ±‡Øç‡Æ±‡ØÅ",
                reset: "‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡Øà‡ÆØ‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡ØÄ‡Æü‡Øç‡Æü‡ÆÆ‡Øà",
                fullscreen: "‡ÆÆ‡ØÅ‡Æ¥‡ØÅ‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡Øà",
                addNote: "‡Æï‡ØÅ‡Æ±‡Æø‡Æ™‡Øç‡Æ™‡ØÅ ‡Æö‡Øá‡Æ∞‡Øç",
                undo: "‡Æö‡ØÜ‡ÆØ‡Æ≤‡Øç‡Æ§‡Æµ‡Æø‡Æ∞‡Øç",
                darkMode: "‡Æá‡Æ∞‡ØÅ‡Æ£‡Øç‡Æü ‡Æ™‡ÆØ‡Æ©‡Øç‡ÆÆ‡ØÅ‡Æ±‡Øà",
                lastNoteReset: "‡Æá‡Æ§‡ØÅ ‡Æï‡Æü‡Øà‡Æö‡Æø ‡Æï‡ØÅ‡Æ±‡Æø‡Æ™‡Øç‡Æ™‡ØÅ. ‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡ØÅ ‡Æï‡ØÅ‡Æ±‡Æø‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øà‡ÆØ‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡ØÄ‡Æü‡Øç‡Æü‡ÆÆ‡Øà‡Æï‡Øç‡Æï ‡Æµ‡Æø‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡ØÅ‡Æï‡Æø‡Æ±‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Ææ?",
                resetConfirm: "‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡ØÅ ‡Æï‡ØÅ‡Æ±‡Æø‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øà‡ÆØ‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡ØÄ‡Æü‡Øç‡Æü‡ÆÆ‡Øà‡Æï‡Øç‡Æï ‡Æµ‡Æø‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡ØÅ‡Æï‡Æø‡Æ±‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Ææ?",
                loadError: "‡Æï‡ØÅ‡Æ±‡Æø‡Æ™‡Øç‡Æ™‡ØÅ ‡Æè‡Æ±‡Øç‡Æ±‡Æ≤‡Øç ‡Æ™‡Æø‡Æ¥‡Øà: ‡Æ§‡Æµ‡Æ±‡Ææ‡Æ© ‡Æï‡Øã‡Æ™‡Øç‡Æ™‡ØÅ ‡Æµ‡Æü‡Æø‡Æµ‡ÆÆ‡Øç.",
                saveFilePrefix: "‡Æí‡Æü‡Øç‡Æü‡ØÅ_‡Æï‡ØÅ‡Æ±‡Æø‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øç"
            },
            te: {
                pageTitle: "‡∞∏‡±ç‡∞ü‡∞ø‡∞ï‡±Ä ‡∞®‡±ã‡∞ü‡±ç‡∞∏‡±ç",
                settings: "‡∞∏‡±Ü‡∞ü‡±ç‡∞ü‡∞ø‡∞Ç‡∞ó‡±ç‡∞∏‡±ç",
                save: "‡∞∏‡±á‡∞µ‡±ç",
                load: "‡∞≤‡±ã‡∞°‡±ç",
                reset: "‡∞Ö‡∞®‡±ç‡∞®‡±Ä ‡∞∞‡±Ä‡∞∏‡±Ü‡∞ü‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",
                fullscreen: "‡∞™‡±Ç‡∞∞‡±ç‡∞§‡∞ø ‡∞∏‡±ç‡∞ï‡±ç‡∞∞‡±Ä‡∞®‡±ç",
                addNote: "‡∞®‡±ã‡∞ü‡±ç ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø",
                undo: "‡∞∞‡∞¶‡±ç‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",
                darkMode: "‡∞°‡∞æ‡∞∞‡±ç‡∞ï‡±ç ‡∞Æ‡±ã‡∞°‡±ç",
                lastNoteReset: "‡∞á‡∞¶‡∞ø ‡∞ö‡∞ø‡∞µ‡∞∞‡∞ø ‡∞®‡±ã‡∞ü‡±ç. ‡∞Æ‡±Ä‡∞∞‡±Å ‡∞Ö‡∞®‡±ç‡∞®‡∞ø ‡∞®‡±ã‡∞ü‡±ç‡∞∏‡±ç‚Äå‡∞®‡∞ø ‡∞∞‡±Ä‡∞∏‡±Ü‡∞ü‡±ç ‡∞ö‡±á‡∞Ø‡∞æ‡∞≤‡∞®‡±Å‡∞ï‡±Å‡∞Ç‡∞ü‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡∞æ?",
                resetConfirm: "‡∞Æ‡±Ä‡∞∞‡±Å ‡∞Ö‡∞®‡±ç‡∞®‡∞ø ‡∞®‡±ã‡∞ü‡±ç‡∞∏‡±ç‚Äå‡∞®‡∞ø ‡∞∞‡±Ä‡∞∏‡±Ü‡∞ü‡±ç ‡∞ö‡±á‡∞Ø‡∞æ‡∞≤‡∞®‡±Å‡∞ï‡±Å‡∞Ç‡∞ü‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡∞æ?",
                loadError: "‡∞®‡±ã‡∞ü‡±ç ‡∞≤‡±ã‡∞°‡±ç ‡∞≤‡±ã‡∞™‡∞Ç: ‡∞ö‡±Ü‡∞≤‡±ç‡∞≤‡∞®‡∞ø ‡∞´‡±à‡∞≤‡±ç ‡∞´‡∞æ‡∞∞‡±ç‡∞Æ‡∞æ‡∞ü‡±ç.",
                saveFilePrefix: "‡∞∏‡±ç‡∞ü‡∞ø‡∞ï‡±Ä_‡∞®‡±ã‡∞ü‡±ç‡∞∏‡±ç"
            },
            mr: {
                pageTitle: "‡§ö‡§ø‡§™‡§ï‡§£‡§æ‡§∞‡•á ‡§®‡•ã‡§ü‡•ç‡§∏",
                settings: "‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§ú",
                save: "‡§ú‡§§‡§® ‡§ï‡§∞‡§æ",
                load: "‡§≤‡•ã‡§° ‡§ï‡§∞‡§æ",
                reset: "‡§∏‡§∞‡•ç‡§µ ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡§æ",
                fullscreen: "‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®",
                addNote: "‡§®‡•ã‡§ü ‡§ú‡•ã‡§°‡§æ",
                undo: "‡§™‡•Ç‡§∞‡•ç‡§µ‡§µ‡§§ ‡§ï‡§∞‡§æ",
                darkMode: "‡§°‡§æ‡§∞‡•ç‡§ï ‡§Æ‡•ã‡§°",
                lastNoteReset: "‡§π‡•Ä ‡§∂‡•á‡§µ‡§ü‡§ö‡•Ä ‡§®‡•ã‡§ü ‡§Ü‡§π‡•á. ‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§∏‡§∞‡•ç‡§µ ‡§®‡•ã‡§ü‡•ç‡§∏ ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•Ç ‡§á‡§ö‡•ç‡§õ‡§ø‡§§‡§æ ‡§ï‡§æ?",
                resetConfirm: "‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§∏‡§∞‡•ç‡§µ ‡§®‡•ã‡§ü‡•ç‡§∏ ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•Ç ‡§á‡§ö‡•ç‡§õ‡§ø‡§§‡§æ ‡§ï‡§æ?",
                loadError: "‡§®‡•ã‡§ü ‡§≤‡•ã‡§°‡§ø‡§Ç‡§ó ‡§§‡•ç‡§∞‡•Å‡§ü‡•Ä: ‡§Ö‡§µ‡•à‡§ß ‡§´‡§æ‡§á‡§≤ ‡§∏‡•ç‡§µ‡§∞‡•Ç‡§™.",
                saveFilePrefix: "‡§ö‡§ø‡§™‡§ï‡§£‡§æ‡§∞‡•á_‡§®‡•ã‡§ü‡•ç‡§∏"
            },
            ur: {
                pageTitle: "ÿßÿ≥Ÿπ€å⁄©€å ŸÜŸàŸπÿ≥",
                settings: "ÿ™ÿ±ÿ™€åÿ®ÿßÿ™",
                save: "ŸÖÿ≠ŸÅŸàÿ∏ ⁄©ÿ±€å⁄∫",
                load: "ŸÑŸà⁄à ⁄©ÿ±€å⁄∫",
                reset: "ÿ≥ÿ® ⁄©Ÿà ÿ±€å ÿ≥€åŸπ ⁄©ÿ±€å⁄∫",
                fullscreen: "ŸÖ⁄©ŸÖŸÑ ÿßÿ≥⁄©ÿ±€åŸÜ",
                addNote: "ŸÜŸàŸπ ÿ¥ÿßŸÖŸÑ ⁄©ÿ±€å⁄∫",
                undo: "ŸàÿßŸæÿ≥ ŸÑ€å⁄∫",
                darkMode: "⁄àÿßÿ±⁄© ŸÖŸà⁄à",
                lastNoteReset: "€å€Å ÿ¢ÿÆÿ±€å ŸÜŸàŸπ €Å€í€î ⁄©€åÿß ÿ¢Ÿæ ÿ™ŸÖÿßŸÖ ŸÜŸàŸπÿ≥ ⁄©Ÿà ÿ±€å ÿ≥€åŸπ ⁄©ÿ±ŸÜÿß ⁄Üÿß€Åÿ™€í €Å€å⁄∫ÿü",
                resetConfirm: "⁄©€åÿß ÿ¢Ÿæ ÿ™ŸÖÿßŸÖ ŸÜŸàŸπÿ≥ ⁄©Ÿà ÿ±€å ÿ≥€åŸπ ⁄©ÿ±ŸÜÿß ⁄Üÿß€Åÿ™€í €Å€å⁄∫ÿü",
                loadError: "ŸÜŸàŸπ ŸÑŸà⁄àŸÜ⁄Ø ŸÖ€å⁄∫ ÿÆÿ±ÿßÿ®€å: ŸÜÿßÿ¨ÿßÿ¶ÿ≤ ŸÅÿßÿ¶ŸÑ ŸÅÿßÿ±ŸÖ€åŸπ€î",
                saveFilePrefix: "ÿßÿ≥Ÿπ€å⁄©€å_ŸÜŸàŸπÿ≥"
            },
            gu: {
                pageTitle: "‡™∏‡´ç‡™ü‡´Ä‡™ï‡´Ä ‡™®‡´ã‡¶ü‡´ç‡™∏",
                settings: "‡™∏‡´á‡™ü‡™ø‡™Ç‡™ó‡´ç‡™∏",
                save: "‡™∏‡™æ‡™ö‡™µ‡´ã",
                load: "‡™≤‡´ã‡™° ‡™ï‡™∞‡´ã",
                reset: "‡™¨‡™ß‡´Å‡™Ç ‡™∞‡´Ä‡™∏‡´á‡™ü ‡™ï‡™∞‡´ã",
                fullscreen: "‡™™‡´Ç‡™∞‡´ç‡™£ ‡™∏‡´ç‡™ï‡´ç‡™∞‡´Ä‡™®",
                addNote: "‡™®‡´ã‡™ü ‡™â‡™Æ‡´á‡™∞‡´ã",
                undo: "‡™™‡´Ç‡™∞‡´ç‡™µ‡™µ‡™§‡´ç ‡™ï‡™∞‡´ã",
                darkMode: "‡™°‡™æ‡™∞‡´ç‡™ï ‡™Æ‡´ã‡™°",
                lastNoteReset: "‡™Ü ‡™õ‡´á‡™≤‡´ç‡™≤‡´Ä ‡™®‡´ã‡™ü ‡™õ‡´á. ‡™∂‡´Å‡™Ç ‡™§‡™Æ‡´á ‡™¨‡™ß‡´Ä ‡™®‡´ã‡¶ü‡´ç‡™∏ ‡™∞‡´Ä‡™∏‡´á‡™ü ‡™ï‡™∞‡™µ‡™æ ‡™Æ‡™æ‡™Ç‡™ó‡´ã ‡™õ‡´ã?",
                resetConfirm: "‡™∂‡´Å‡™Ç ‡™§‡™Æ‡´á ‡™¨‡™ß‡´Ä ‡™®‡´ã‡¶ü‡´ç‡™∏ ‡™∞‡´Ä‡™∏‡´á‡™ü ‡™ï‡™∞‡™µ‡™æ ‡™Æ‡™æ‡™Ç‡™ó‡´ã ‡™õ‡´ã?",
                loadError: "‡™®‡´ã‡™ü ‡™≤‡´ã‡™°‡™ø‡™Ç‡™ó ‡™≠‡´Ç‡™≤: ‡™Ö‡™Æ‡™æ‡™®‡´ç‡™Ø ‡™´‡™æ‡™á‡™≤ ‡™´‡´ã‡™∞‡´ç‡™Æ‡´á‡™ü.",
                saveFilePrefix: "‡™∏‡´ç‡™ü‡´Ä‡™ï‡´Ä_‡™®‡´ã‡™ü‡´ç‡™∏"
            }
        };

        function getLanguage() {
            const lang = navigator.language.split('-')[0];
            return translations[lang] ? lang : 'en';
        }

        function applyTranslations() {
            const lang = getLanguage();
            const t = translations[lang];

            document.getElementById('page-title').textContent = t.pageTitle;
            document.querySelectorAll('[data-tooltip-key]').forEach(button => {
                const key = button.getAttribute('data-tooltip-key');
                button.setAttribute('data-tooltip', t[key]);
                const tooltip = button.querySelector('.tooltip');
                if (tooltip) {
                    tooltip.textContent = t[key];
                }
            });
        }

        let noteId = 0;
        let deletedNotes = [];
        let maxZIndex = 1;

        function debounce(func, wait) {
            let timeout;
            return function (...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }

        function saveDarkModeState() {
            const isDarkMode = document.body.classList.contains("dark-mode");
            localStorage.setItem("darkMode", isDarkMode);
        }

        function loadDarkModeState() {
            const savedDarkMode = localStorage.getItem("darkMode");
            if (savedDarkMode === "true") {
                document.body.classList.add("dark-mode");
                document.body.classList.remove("light-mode");
            } else {
                document.body.classList.add("light-mode");
                document.body.classList.remove("dark-mode");
            }
            updateDarkModeIcon();
        }

        function updateDarkModeIcon() {
            const darkModeIcon = document.getElementById("darkModeIcon");
            if (document.body.classList.contains("dark-mode")) {
                darkModeIcon.textContent = "üåô";
            } else {
                darkModeIcon.textContent = "‚òÄÔ∏è";
            }
        }

        function toggleDarkMode() {
            document.body.classList.toggle("dark-mode");
            document.body.classList.toggle("light-mode");
            saveDarkModeState();
            updateDarkModeIcon();
        }

        function toggleSettingsMenu() {
            const menu = document.querySelector(".bottom-left-buttons");
            menu.classList.toggle("show");
        }

        function bringToFront(note) {
            maxZIndex++;
            note.style.zIndex = maxZIndex;
            saveNotesToLocalStorage();
        }

        function createStickyNote(savedNote = null) {
            const container = document.getElementById("container");
            const note = document.createElement("div");
            note.className = "note";
            let currentNoteId;

            if (savedNote && savedNote.id) {
                currentNoteId = savedNote.id.split('_')[1];
                note.id = savedNote.id;
                noteId = Math.max(noteId, parseInt(currentNoteId) + 1);
            } else {
                currentNoteId = noteId.toString();
                note.id = "note_" + currentNoteId;
                noteId++;
            }

            function positionNoteInCenter() {
                const noteWidth = 300;
                const noteHeight = 300;
                const containerWidth = window.innerWidth;
                const containerHeight = window.innerHeight;

                const leftPercent = ((containerWidth - noteWidth) / 2 / containerWidth) * 100;
                const topPercent = ((containerHeight - noteHeight) / 2 / containerHeight) * 100;

                note.style.left = `${leftPercent}%`;
                note.style.top = `${topPercent}%`;
                note.dataset.leftPercent = leftPercent;
                note.dataset.topPercent = topPercent;
            }

            if (savedNote) {
                note.style.left = `${savedNote.leftPercent}%`;
                note.style.top = `${savedNote.topPercent}%`;
                note.dataset.leftPercent = savedNote.leftPercent;
                note.dataset.topPercent = savedNote.topPercent;
                note.style.width = savedNote.width || "300px";
                note.style.height = savedNote.height || "300px";
                note.style.zIndex = savedNote.zIndex || maxZIndex;
                note.dataset.fontSize = savedNote.fontSize || "15px";
                note.dataset.fontColor = savedNote.fontColor || "#000000";
            } else {
                positionNoteInCenter();
                note.dataset.fontSize = "15px";
                note.dataset.fontColor = "#000000";
                note.style.zIndex = maxZIndex;
                note.style.width = "300px";
            }

            note.innerHTML = `
                <div class="header">
                    <div class="left-group">
                        <button class="add-note">+</button>
                        <div class="toolbar">
                            <select class="font-size">
                                <option value="10px">10px</option>
                                <option value="12px">12px</option>
                                <option value="15px" selected>15px</option>
                                <option value="18px">18px</option>
                                <option value="24px">24px</option>
                                <option value="30px">30px</option>
                                <option value="36px">36px</option>
                                <option value="42px">42px</option>
                                <option value="50px">50px</option>
                            </select>
                            <input type="color" class="font-color" value="${savedNote ? savedNote.fontColor || '#000000' : '#000000'}">
                            <button class="bold">B</button>
                            <button class="italic">I</button>
                            <button class="underline">U</button>
                            <button class="strikethrough">S</button>
                        </div>
                    </div>
                    <button class="delete" data-id="${note.id}">‚úñ</button>
                </div>
                <div class="content" contenteditable="true">${savedNote ? savedNote.content || "" : ""}</div>
            `;

            container.appendChild(note);

            const header = note.querySelector(".header");
            header.addEventListener("mousedown", startDrag);
            header.addEventListener("touchstart", startDrag, { passive: false });

            const content = note.querySelector(".content");
            const fontSizeSelect = note.querySelector(".font-size");
            const fontColorInput = note.querySelector(".font-color");

            if (savedNote) {
                fontSizeSelect.value = savedNote.fontSize || "15px";
                fontColorInput.value = savedNote.fontColor || "#000000";
                content.style.fontSize = savedNote.fontSize || "15px";
                if (savedNote.fontColor) content.style.color = savedNote.fontColor;
            } else {
                content.style.fontSize = note.dataset.fontSize;
            }

            content.addEventListener("input", (e) => {
                if (e.isComposing || e.inputType === "insertCompositionText") {
                    return;
                }
                debounce(saveNotesToLocalStorage, 500)();
            });

            content.addEventListener("compositionend", () => {
                debounce(saveNotesToLocalStorage, 500)();
            });

            content.addEventListener("focus", () => bringToFront(note));

            content.addEventListener("paste", (e) => {
                e.preventDefault();
                const clipboardData = e.clipboardData;
                const textData = clipboardData.getData("text/plain");
                const selection = window.getSelection();
                if (selection.rangeCount) {
                    const range = selection.getRangeAt(0);
                    range.deleteContents();
                    range.insertNode(document.createTextNode(textData));
                    range.collapse(false);
                    selection.removeAllRanges();
                    selection.addRange(range);
                }
                debounce(saveNotesToLocalStorage, 500)();
            });

            content.addEventListener("keydown", (e) => {
                if (e.isComposing || e.keyCode === 229) {
                    return;
                }
                if (document.activeElement !== content) {
                    return;
                }
                e.stopPropagation();
                if (e.key === "Tab") {
                    e.preventDefault();
                    const selection = window.getSelection();
                    if (selection.rangeCount) {
                        const range = selection.getRangeAt(0);
                        const textNode = document.createTextNode("  ");
                        range.insertNode(textNode);
                        range.setStartAfter(textNode);
                        range.setEndAfter(textNode);
                        selection.removeAllRanges();
                        selection.addRange(range);
                    }
                    debounce(saveNotesToLocalStorage, 500)();
                    return;
                }
                if (e.ctrlKey || e.metaKey) {
                    const selection = window.getSelection();
                    if (selection.rangeCount) {
                        if (e.key === "z" || e.key === "Z") {
                            e.preventDefault();
                            document.execCommand("undo", false, null);
                            debounce(saveNotesToLocalStorage, 500)();
                            return;
                        }
                        if (e.key === "b" || e.key === "B") {
                            e.preventDefault();
                            document.execCommand("bold", false, null);
                            debounce(saveNotesToLocalStorage, 500)();
                            return;
                        }
                        if (e.key === "i" || e.key === "I") {
                            e.preventDefault();
                            document.execCommand("italic", false, null);
                            debounce(saveNotesToLocalStorage, 500)();
                            return;
                        }
                        if (e.key === "u" || e.key === "U") {
                            e.preventDefault();
                            document.execCommand("underline", false, null);
                            debounce(saveNotesToLocalStorage, 500)();
                            return;
                        }
                    }
                    return;
                }
            });

            const leftResizeHandle = document.createElement("div");
            leftResizeHandle.className = "resize-handle left";
            note.appendChild(leftResizeHandle);
            leftResizeHandle.addEventListener("mousedown", startResize);
            leftResizeHandle.addEventListener("touchstart", startResize, { passive: false });

            const rightResizeHandle = document.createElement("div");
            rightResizeHandle.className = "resize-handle right";
            note.appendChild(rightResizeHandle);
            rightResizeHandle.addEventListener("mousedown", startResize);
            rightResizeHandle.addEventListener("touchstart", startResize, { passive: false });

            const bottomResizeHandle = document.createElement("div");
            bottomResizeHandle.className = "resize-handle bottom";
            note.appendChild(bottomResizeHandle);
            bottomResizeHandle.addEventListener("mousedown", startResize);
            bottomResizeHandle.addEventListener("touchstart", startResize, { passive: false });

            const bottomLeftResizeHandle = document.createElement("div");
            bottomLeftResizeHandle.className = "resize-handle bottom-left";
            note.appendChild(bottomLeftResizeHandle);
            bottomLeftResizeHandle.addEventListener("mousedown", startResize);
            bottomLeftResizeHandle.addEventListener("touchstart", startResize, { passive: false });

            const bottomRightResizeHandle = document.createElement("div");
            bottomRightResizeHandle.className = "resize-handle bottom-right";
            note.appendChild(bottomRightResizeHandle);
            bottomRightResizeHandle.addEventListener("mousedown", startResize);
            bottomRightResizeHandle.addEventListener("touchstart", startResize, { passive: false });

            fontSizeSelect.addEventListener("change", (e) => {
                note.dataset.fontSize = e.target.value;
                content.style.fontSize = note.dataset.fontSize;
                const spans = content.querySelectorAll("span[style*='font-size']");
                spans.forEach(span => {
                    span.style.fontSize = '';
                    if (!span.getAttribute('style')) span.removeAttribute('style');
                });
                content.focus();
                saveNotesToLocalStorage();
            });

            fontColorInput.addEventListener("input", (e) => {
                content.style.color = e.target.value;
                note.dataset.fontColor = e.target.value;
                const spans = content.querySelectorAll("span[style*='color']");
                spans.forEach(span => {
                    span.style.color = '';
                    if (!span.getAttribute('style')) span.removeAttribute('style');
                });
                content.focus();
                saveNotesToLocalStorage();
            });

            const applyStyleToSelection = (button, command) => {
                button.addEventListener("click", () => {
                    const selection = window.getSelection();
                    if (selection.rangeCount && !selection.isCollapsed) {
                        document.execCommand(command, false, null);
                    }
                    content.focus();
                    saveNotesToLocalStorage();
                });
            };

            applyStyleToSelection(note.querySelector(".bold"), "bold");
            applyStyleToSelection(note.querySelector(".italic"), "italic");
            applyStyleToSelection(note.querySelector(".underline"), "underline");
            applyStyleToSelection(note.querySelector(".strikethrough"), "strikeThrough");

            note.querySelector(".add-note").addEventListener("click", (event) => {
                event.preventDefault();
                event.stopPropagation();
                content.blur();
                createStickyNote();
            });

            note.querySelector(".delete").addEventListener("click", (event) => {
                event.preventDefault();
                event.stopPropagation();
                content.blur();
                const noteIdToDelete = event.currentTarget.getAttribute("data-id");
                deleteStickyNote(noteIdToDelete);
            });

            saveNotesToLocalStorage();
        }

        let isDragging = false;
        let isResizing = false;
        let currentNote = null;
        let initialWidth = 0;
        let initialHeight = 0;
        let initialX = 0;
        let initialY = 0;
        let initialLeft = 0;

        function startResize(event) {
            event.preventDefault();
            isResizing = true;
            currentNote = event.target.closest(".note");
            bringToFront(currentNote);

            initialWidth = parseFloat(currentNote.style.width) || currentNote.offsetWidth;
            initialHeight = parseFloat(currentNote.style.height) || currentNote.offsetHeight;
            initialLeft = parseFloat(currentNote.style.left) || (currentNote.offsetLeft / window.innerWidth * 100);

            if (event.type === "touchstart") {
                const touch = event.touches[0];
                initialX = touch.clientX;
                initialY = touch.clientY;
            } else {
                initialX = event.clientX;
                initialY = event.clientY;
            }

            if (event.target.classList.contains("bottom-left")) {
                currentNote.dataset.resizeSide = "bottom-left";
            } else if (event.target.classList.contains("bottom-right")) {
                currentNote.dataset.resizeSide = "bottom-right";
            } else if (event.target.classList.contains("left")) {
                currentNote.dataset.resizeSide = "left";
            } else if (event.target.classList.contains("right")) {
                currentNote.dataset.resizeSide = "right";
            } else if (event.target.classList.contains("bottom")) {
                currentNote.dataset.resizeSide = "bottom";
            }

            document.addEventListener("mousemove", resizeNote);
            document.addEventListener("mouseup", stopResize);
            document.addEventListener("touchmove", resizeNote, { passive: false });
            document.addEventListener("touchend", stopResize);
        }

        function resizeNote(event) {
            if (!isResizing || !currentNote) return;

            event.preventDefault();

            let deltaX, deltaY;
            if (event.type === "touchmove") {
                const touch = event.touches[0];
                deltaX = touch.clientX - initialX;
                deltaY = touch.clientY - initialY;
            } else {
                deltaX = event.clientX - initialX;
                deltaY = event.clientY - initialY;
            }

            let newWidth, newHeight, newLeftPercent;
            const resizeSide = currentNote.dataset.resizeSide;

            if (resizeSide === "bottom-left") {
                newWidth = Math.max(Math.min(initialWidth - deltaX, window.innerWidth * 0.9), 300);
                newHeight = Math.max(Math.min(initialHeight + deltaY, window.innerHeight * 0.9), 80);
                const newLeft = initialLeft + (initialWidth - newWidth) / window.innerWidth * 100;
                newLeftPercent = Math.max(0, Math.min(newLeft, 100 - (newWidth / window.innerWidth * 100)));
                currentNote.style.left = `${newLeftPercent}%`;
                currentNote.style.width = `${newWidth}px`;
                currentNote.style.height = `${newHeight}px`;
                currentNote.dataset.leftPercent = newLeftPercent;
            } else if (resizeSide === "bottom-right") {
                newWidth = Math.max(Math.min(initialWidth + deltaX, window.innerWidth * 0.9), 300);
                newHeight = Math.max(Math.min(initialHeight + deltaY, window.innerHeight * 0.9), 80);
                currentNote.style.width = `${newWidth}px`;
                currentNote.style.height = `${newHeight}px`;
            } else if (resizeSide === "left") {
                newWidth = Math.max(Math.min(initialWidth - deltaX, window.innerWidth * 0.9), 300);
                const newLeft = initialLeft + (initialWidth - newWidth) / window.innerWidth * 100;
                newLeftPercent = Math.max(0, Math.min(newLeft, 100 - (newWidth / window.innerWidth * 100)));
                currentNote.style.left = `${newLeftPercent}%`;
                currentNote.style.width = `${newWidth}px`;
                currentNote.dataset.leftPercent = newLeftPercent;
            } else if (resizeSide === "right") {
                newWidth = Math.max(Math.min(initialWidth + deltaX, window.innerWidth * 0.9), 300);
                currentNote.style.width = `${newWidth}px`;
            } else if (resizeSide === "bottom") {
                newHeight = Math.max(Math.min(initialHeight + deltaY, window.innerHeight * 0.9), 80);
                currentNote.style.height = `${newHeight}px`;
            }
        }

        function stopResize() {
            isResizing = false;
            currentNote = null;
            document.removeEventListener("mousemove", resizeNote);
            document.removeEventListener("mouseup", stopResize);
            document.removeEventListener("touchmove", resizeNote);
            document.removeEventListener("touchend", stopResize);
            saveNotesToLocalStorage();
        }

        function startDrag(event) {
            const header = event.target.closest(".header");
            if (!header || event.target.tagName === "BUTTON" || event.target.tagName === "SELECT" || event.target.tagName === "INPUT") return;

            event.preventDefault();
            isDragging = true;
            const note = header.closest(".note");
            bringToFront(note);

            const rect = note.getBoundingClientRect();
            let offsetX, offsetY;

            if (event.type === "touchstart") {
                const touch = event.touches[0];
                offsetX = touch.clientX - rect.left;
                offsetY = touch.clientY - rect.top;
            } else {
                offsetX = event.clientX - rect.left;
                offsetY = event.clientY - rect.top;
            }

            function dragNote(event) {
                event.preventDefault();
                if (!isDragging) return;

                const containerWidth = window.innerWidth;
                const containerHeight = window.innerHeight;
                let newNoteX, newNoteY;

                if (event.type === "touchmove") {
                    const touch = event.touches[0];
                    newNoteX = touch.clientX - offsetX;
                    newNoteY = touch.clientY - offsetY;
                } else {
                    newNoteX = event.clientX - offsetX;
                    newNoteY = event.clientY - offsetY;
                }

                let leftPercent = (newNoteX / containerWidth) * 100;
                let topPercent = (newNoteY / containerHeight) * 100;
                leftPercent = Math.max(0, Math.min(leftPercent, 100 - (note.offsetWidth / containerWidth) * 100));
                topPercent = Math.max(0, Math.min(topPercent, 100 - (note.offsetHeight / containerHeight) * 100));

                note.style.left = `${leftPercent}%`;
                note.style.top = `${topPercent}%`;
                note.dataset.leftPercent = leftPercent;
                note.dataset.topPercent = topPercent;
            }

            function stopDrag() {
                isDragging = false;
                document.removeEventListener("mousemove", dragNote);
                document.removeEventListener("mouseup", stopDrag);
                document.removeEventListener("touchmove", dragNote);
                document.removeEventListener("touchend", stopDrag);
                saveNotesToLocalStorage();
            }

            document.addEventListener("mousemove", dragNote);
            document.addEventListener("mouseup", stopDrag);
            document.addEventListener("touchmove", dragNote, { passive: false });
            document.addEventListener("touchend", stopDrag);
        }

        function deleteStickyNote(noteId) {
            const note = document.getElementById(noteId);
            if (!note) return;

            const container = document.getElementById("container");
            const notes = container.getElementsByClassName("note");
            const lang = getLanguage();
            const t = translations[lang];

            if (notes.length === 1) {
                if (confirm(t.lastNoteReset)) {
                    resetNotes();
                }
            } else {
                deletedNotes.push({
                    id: note.id,
                    content: note.querySelector(".content").innerHTML,
                    leftPercent: note.dataset.leftPercent || (parseFloat(note.style.left) / window.innerWidth * 100) || 50,
                    topPercent: note.dataset.topPercent || (parseFloat(note.style.top) / window.innerHeight * 100) || 50,
                    height: note.style.height || "300px",
                    width: note.style.width || "300px",
                    zIndex: note.style.zIndex || 1,
                    fontSize: note.dataset.fontSize || "15px",
                    fontColor: note.dataset.fontColor || "#000000"
                });
                note.remove();
                saveNotesToLocalStorage();
            }
        }

        function undoDelete() {
            if (deletedNotes.length === 0) return;

            const deletedNote = deletedNotes.pop();
            createStickyNote(deletedNote);
        }

        function openResetConfirmation() {
            const lang = getLanguage();
            const t = translations[lang];
            if (confirm(t.resetConfirm)) {
                resetNotes();
            }
        }

        function resetNotes() {
            const container = document.getElementById("container");
            container.innerHTML = "";
            noteId = 0;
            deletedNotes = [];
            maxZIndex = 1;
            localStorage.removeItem("stickyNotes");
            localStorage.removeItem("deletedNotes");
            localStorage.removeItem("noteId");
            localStorage.removeItem("maxZIndex");
            createStickyNote();
            saveNotesToLocalStorage();
        }

        function saveNotesToLocalStorage() {
            const notes = document.getElementsByClassName("note");
            const notesArray = Array.from(notes).map(note => ({
                id: note.id,
                content: note.querySelector(".content").innerHTML,
                leftPercent: note.dataset.leftPercent || (parseFloat(note.style.left) / window.innerWidth * 100) || 50,
                topPercent: note.dataset.topPercent || (parseFloat(note.style.top) / window.innerHeight * 100) || 50,
                height: note.style.height || "300px",
                width: note.style.width || "300px",
                zIndex: note.style.zIndex || 1,
                fontSize: note.dataset.fontSize || "15px",
                fontColor: note.dataset.fontColor || "#000000"
            }));
            localStorage.setItem("stickyNotes", JSON.stringify(notesArray));
            localStorage.setItem("deletedNotes", JSON.stringify(deletedNotes));
            localStorage.setItem("noteId", noteId);
            localStorage.setItem("maxZIndex", maxZIndex);
        }

        function loadNotesFromLocalStorage() {
            const savedNotes = localStorage.getItem("stickyNotes");
            const savedDeletedNotes = localStorage.getItem("deletedNotes");
            const savedNoteId = localStorage.getItem("noteId");
            const savedMaxZIndex = localStorage.getItem("maxZIndex");

            if (savedDeletedNotes) {
                deletedNotes = JSON.parse(savedDeletedNotes) || [];
            }
            if (savedNoteId) {
                noteId = parseInt(savedNoteId) || 0;
            }
            if (savedMaxZIndex) {
                maxZIndex = parseInt(savedMaxZIndex) || 1;
            }

            if (savedNotes) {
                try {
                    const notesArray = JSON.parse(savedNotes);
                    if (!Array.isArray(notesArray) || notesArray.length === 0) {
                        createStickyNote();
                        return;
                    }

                    const container = document.getElementById("container");
                    container.innerHTML = "";
                    notesArray.forEach(note => createStickyNote(note));
                } catch (error) {
                    const lang = getLanguage();
                    const t = translations[lang];
                    alert(t.loadError);
                    createStickyNote();
                }
            } else {
                createStickyNote();
            }
        }

        function saveNotes() {
            const notes = document.getElementsByClassName("note");
            const notesArray = Array.from(notes).map(note => ({
                id: note.id,
                content: note.querySelector(".content").innerHTML,
                leftPercent: note.dataset.leftPercent || (parseFloat(note.style.left) / window.innerWidth * 100) || 50,
                topPercent: note.dataset.topPercent || (parseFloat(note.style.top) / window.innerHeight * 100) || 50,
                height: note.style.height || "300px",
                width: note.style.width || "300px",
                zIndex: note.style.zIndex || 1,
                fontSize: note.dataset.fontSize || "15px",
                fontColor: note.dataset.fontColor || "#000000"
            }));
            const data = {
                notes: notesArray,
                deletedNotes: deletedNotes,
                noteId: noteId,
                maxZIndex: maxZIndex
            };

            const lang = getLanguage();
            const t = translations[lang];
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            const timestamp = `${year}${month}${day}_${hours}${minutes}${seconds}`;
            const filename = `${t.saveFilePrefix}_${timestamp}.json`;

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function loadNotesFromFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    const container = document.getElementById("container");
                    container.innerHTML = "";

                    noteId = data.noteId || 0;
                    maxZIndex = data.maxZIndex || 1;
                    deletedNotes = data.deletedNotes || [];

                    (data.notes || []).forEach(note => {
                        note.leftPercent = Math.max(0, Math.min(note.leftPercent || 50, 100));
                        note.topPercent = Math.max(0, Math.min(note.topPercent || 50, 100));
                        createStickyNote(note);
                    });
                    saveNotesToLocalStorage();
                } catch (error) {
                    const lang = getLanguage();
                    const t = translations[lang];
                    alert(t.loadError);
                    createStickyNote();
                }
            };
            reader.readAsText(file);
        }

        function setupTooltips() {
            const buttons = document.querySelectorAll('.bottom-left-buttons button, .bottom-right-buttons button, #settingsBtn');
            const isMobile = window.innerWidth <= 768;

            buttons.forEach(button => {
                const key = button.getAttribute('data-tooltip-key');
                const lang = getLanguage();
                const tooltipText = translations[lang][key];
                if (tooltipText) {
                    const tooltip = document.createElement('span');
                    tooltip.className = 'tooltip';
                    tooltip.textContent = tooltipText;
                    button.appendChild(tooltip);

                    if (isMobile) {
                        button.addEventListener('touchstart', (e) => {
                            button.classList.add('touched');
                        }, { passive: true });

                        button.addEventListener('touchend', () => {
                            button.classList.remove('touched');
                        }, { passive: true });
                    }
                }
            });

            document.addEventListener('touchstart', (e) => {
                if (!e.target.closest('.bottom-left-buttons button, .bottom-right-buttons button, #settingsBtn')) {
                    buttons.forEach(button => button.classList.remove('touched'));
                }
            }, { passive: true });
        }

        function handleButtonClick(id, action) {
            const button = document.getElementById(id);
            button.addEventListener('click', (event) => {
                event.preventDefault();
                event.stopPropagation();
                const focusedContent = document.querySelector(".note .content:focus");
                if (focusedContent) focusedContent.blur();
                action();
            });

            button.addEventListener('touchend', (event) => {
                event.preventDefault();
                event.stopPropagation();
                const focusedContent = document.querySelector(".note .content:focus");
                if (focusedContent) focusedContent.blur();
                action();
            }, { passive: false });
        }

        handleButtonClick("settingsBtn", toggleSettingsMenu);
        handleButtonClick("saveBtn", () => {
            saveNotes();
            toggleSettingsMenu();
        });
        handleButtonClick("loadBtn", () => {
            document.getElementById("loadFile").click();
            toggleSettingsMenu();
        });
        handleButtonClick("resetBtn", () => {
            openResetConfirmation();
            toggleSettingsMenu();
        });
        handleButtonClick("addBtn", createStickyNote);
        handleButtonClick("undoBtn", undoDelete);
        handleButtonClick("darkModeToggle", toggleDarkMode);

        document.getElementById("fullscreenBtn").addEventListener("click", toggleFullscreen);
        document.getElementById("fullscreenBtn").addEventListener("touchend", (event) => {
            event.preventDefault();
            toggleFullscreen();
        }, { passive: false });

        function toggleFullscreen() {
            const fullscreenBtn = document.getElementById("fullscreenBtn");
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().then(() => {
                    fullscreenBtn.textContent = "‚úñ";
                }).catch(err => {});
            } else {
                document.exitFullscreen().then(() => {
                    fullscreenBtn.textContent = "‚õ∂";
                }).catch(err => {});
            }
        }

        document.addEventListener("fullscreenchange", () => {
            const fullscreenBtn = document.getElementById("fullscreenBtn");
            if (!document.fullscreenElement) {
                fullscreenBtn.textContent = "‚õ∂";
            } else {
                fullscreenBtn.textContent = "‚úñ";
            }
        });

        window.onload = () => {
            loadDarkModeState();
            loadNotesFromLocalStorage();
            applyTranslations();
            setupTooltips();
        };
    </script>
</body>
</html>